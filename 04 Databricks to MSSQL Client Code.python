{"version":"NotebookV1","origId":1343992488731658,"name":"04 Databricks to MSSQL Client Code","language":"python","commands":[{"version":"CommandV1","origId":1343992488731659,"guid":"6a03c4aa-a4d9-49bb-9b4d-809c0acb21ff","subtype":"command","commandType":"auto","position":1.0,"command":"%md ### Initialize JDBC","commandVersion":1,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":null,"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6c6fbff8-e7a6-409c-af4e-247b14e18ed6"},{"version":"CommandV1","origId":1343992488731660,"guid":"27d15dd3-5201-400e-a6c3-b1624f739574","subtype":"command","commandType":"auto","position":8.8125,"command":"%pip install jaydebeapi","commandVersion":6,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"\u001B[43mNote: you may need to restart the kernel using dbutils.library.restartPython() to use updated packages.\u001B[0m\nCollecting jaydebeapi\n  Downloading JayDeBeApi-1.2.3-py3-none-any.whl (26 kB)\nCollecting JPype1\n  Downloading JPype1-1.4.1-cp310-cp310-manylinux_2_12_x86_64.manylinux2010_x86_64.whl (465 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 465.3/465.3 kB 9.3 MB/s eta 0:00:00\nRequirement already satisfied: packaging in /databricks/python3/lib/python3.10/site-packages (from JPype1->jaydebeapi) (21.3)\nRequirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /databricks/python3/lib/python3.10/site-packages (from packaging->JPype1->jaydebeapi) (3.0.9)\nInstalling collected packages: JPype1, jaydebeapi\nSuccessfully installed JPype1-1.4.1 jaydebeapi-1.2.3\n\u001B[43mNote: you may need to restart the kernel using dbutils.library.restartPython() to use updated packages.\u001B[0m\n","name":"stdout","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1689676313107,"submitTime":1689676308936,"finishTime":1689676317902,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",880]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"049bd3fa-7c95-40a0-a287-559e40abe7a1"},{"version":"CommandV1","origId":1343992488731661,"guid":"03a0fe82-15d4-47c9-b3af-4a959c969469","subtype":"command","commandType":"auto","position":16.625,"command":"import jaydebeapi\n\njdbcHostname = \"10.10.9.4\"\njdbcPort = 1433\njdbcDatabase = \"NCH_Triyam\"\njdbcUsername = \"koantekUser\"\njdbcPassword = \"aBjO40oTOy&4l0\"\n# Create the JDBC URL without passing in the user and password parameters.\njdbcDriver = \"com.microsoft.sqlserver.jdbc.SQLServerDriver\"\njdbcUrl = f\"jdbc:sqlserver://{jdbcHostname}:{jdbcPort};databaseName={jdbcDatabase};user={jdbcUsername};password={jdbcPassword};TrustServerCertificate=True\"\n\n# schemadf = spark.read.FORMAT(\"jdbc\").option(\"url\", jdbcUrl).option(\"dbtable\", \"INFORMATION_SCHEMA.[TABLES]\").load()\n# display(schemadf)\n\n# Specify the JDBC driver class name and connection URL\ndriver = \"com.microsoft.sqlserver.jdbc.SQLServerDriver\"\nurl = \"jdbc:mysql://your_database_host:your_database_port/your_database_name\"\n\n# Specify the path to the JDBC driver JAR file\njar_file = \"/path/to/your/driver.jar\"\n\n# Establish a connection using JayDeBeApi\nconnection = jaydebeapi.connect(driver, jdbcUrl, [])\nimport pandas as pd\ndef exec_sql(cmd):\n    df = pd.read_sql(cmd,connection)\n    display(df)\n","commandVersion":5,"state":"finished","results":{"type":"listResults","data":[{"type":"mimeBundle","data":{"text/plain":"","application/vnd.databricks.v1+bamboolib_hint":"{\"pd.DataFrames\": [], \"version\": \"0.0.1\"}"},"executionCount":null,"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"kernelSessionId":"056b756f-21c3710439bf92c46ad6c24b"}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1689676329646,"submitTime":1689676329621,"finishTime":1689676332583,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["mimeBundle",null]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ddf093b5-d499-4de8-9bfe-a7abffb742ad"},{"version":"CommandV1","origId":1343992488731662,"guid":"30a367f1-15d0-4da2-93d7-471757d7adec","subtype":"command","commandType":"auto","position":17.5703125,"command":"exec_sql(\"select * from sys.procedures\")","commandVersion":11,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"/databricks/python/lib/python3.10/site-packages/pandas/io/sql.py:762: UserWarning: pandas only support SQLAlchemy connectable(engine/connection) ordatabase string URI or sqlite3 DBAPI2 connectionother DBAPI2 objects are not tested, please consider using SQLAlchemy\n  warnings.warn(\n","name":"stderr","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},{"type":"table","data":[["NCH_Cerner_Clinical_Summary_Patient_Demographics_Test",487060871,null,5,0,"P ","SQL_STORED_PROCEDURE","2022-07-07 07:54:44.270000","2022-07-07 08:04:00.253000",0,0,0,0,0,0,0],["tm_archiver_result_review_comments",855778206,null,5,0,"P ","SQL_STORED_PROCEDURE","2022-08-17 06:54:31.330000","2022-08-17 06:54:31.330000",0,0,0,0,0,0,0],["CreateTable_TZ",898102240,null,5,0,"P ","SQL_STORED_PROCEDURE","2022-03-27 16:12:12.940000","2022-03-29 09:22:40.153000",0,0,0,0,0,0,0],["CreateTable_TZ_1",1074102867,null,5,0,"P ","SQL_STORED_PROCEDURE","2022-03-28 10:56:46.380000","2022-03-28 10:56:46.380000",0,0,0,0,0,0,0],["tm_archiver_result_review_V1",1544548736,null,5,0,"P ","SQL_STORED_PROCEDURE","2023-07-10 14:38:41.557000","2023-07-10 14:38:41.557000",0,0,0,0,0,0,0],["NCHC_Orders_V1",1560548793,null,5,0,"P ","SQL_STORED_PROCEDURE","2023-07-10 14:41:23.933000","2023-07-10 14:41:23.933000",0,0,0,0,0,0,0],["NCH_Cerner_mar_V1",1576548850,null,5,0,"P ","SQL_STORED_PROCEDURE","2023-07-10 14:44:02.700000","2023-07-10 14:44:02.700000",0,0,0,0,0,0,0],["CreateTable",1685581043,null,5,0,"P ","SQL_STORED_PROCEDURE","2022-03-07 07:04:15.517000","2022-03-28 15:48:38.157000",0,0,0,0,0,0,0],["GenerateCCLProgram_V1_timezone",1845581613,null,5,0,"P ","SQL_STORED_PROCEDURE","2022-03-08 15:39:45.313000","2022-03-09 11:59:32.430000",0,0,0,0,0,0,0],["NCH_Cerner_Clinical_Summary_299",1913877985,null,5,0,"P ","SQL_STORED_PROCEDURE","2022-10-13 06:43:09.717000","2023-03-23 07:22:04.157000",0,0,0,0,0,0,0],["NCH_CERNER_RESULT_REVIEW_V1",1932026114,null,5,0,"P ","SQL_STORED_PROCEDURE","2023-05-09 16:46:49.333000","2023-05-10 17:38:48.337000",0,0,0,0,0,0,0],["NCH_Cerner_Orders_Detail_DR",1980026285,null,5,0,"P ","SQL_STORED_PROCEDURE","2023-05-10 17:10:29.180000","2023-05-10 17:53:28.703000",0,0,0,0,0,0,0],["NCH_CERNER_MAR_ALL_V1",1996026342,null,5,0,"P ","SQL_STORED_PROCEDURE","2023-05-10 17:12:17.947000","2023-05-10 17:38:56.537000",0,0,0,0,0,0,0],["tm_archiver_immunizations_V1",2121878726,null,5,0,"P ","SQL_STORED_PROCEDURE","2022-10-21 14:52:30.700000","2022-10-21 14:52:30.700000",0,0,0,0,0,0,0]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"name","type":"\"string\"","metadata":"{}"},{"name":"object_id","type":"\"long\"","metadata":"{}"},{"name":"principal_id","type":"\"void\"","metadata":"{}"},{"name":"schema_id","type":"\"long\"","metadata":"{}"},{"name":"parent_object_id","type":"\"long\"","metadata":"{}"},{"name":"type","type":"\"string\"","metadata":"{}"},{"name":"type_desc","type":"\"string\"","metadata":"{}"},{"name":"create_date","type":"\"string\"","metadata":"{}"},{"name":"modify_date","type":"\"string\"","metadata":"{}"},{"name":"is_ms_shipped","type":"\"long\"","metadata":"{}"},{"name":"is_published","type":"\"long\"","metadata":"{}"},{"name":"is_schema_published","type":"\"long\"","metadata":"{}"},{"name":"is_auto_executed","type":"\"long\"","metadata":"{}"},{"name":"is_execution_replicated","type":"\"long\"","metadata":"{}"},{"name":"is_repl_serializable_only","type":"\"long\"","metadata":"{}"},{"name":"skips_repl_constraints","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1689676343183,"submitTime":1689676343162,"finishTime":1689676344533,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",282],["table",14]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"602d6a26-a8a4-4c71-9942-912e73bab557"}],"dashboards":[],"guid":"c3fb715a-7b7b-4c6c-840e-2bb53bdd7a65","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":2,"mostRecentlyExecutedCommandWithImplicitDF":{"commandId":1730429962565480,"dataframes":["_sqldf"]}},"reposExportFormat":"SOURCE"}